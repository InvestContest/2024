## Загрузка исторических рыночных данных в виде архива

TINKOFF INVEST API предоставляет своим пользователям возможность получения исторических рыночных данных по
инструментам за год в виде архива. Для загрузки истории котировок можно воспользоваться специальным методом или подготовленными [скриптом и справочником figi](https://github.com/RussianInvestments/investAPI/tree/main/src/marketdata).

### Метод загрузки исторических рыночных данных по инструменту в виде годового архива

Для загрузки исторических рыночных данных в виде архива по определенному инструменту необходимо передать **GET** запрос на url: `https://invest-public-api.tinkoff.ru/history-data` с указанными ниже параметрами, а также Bearer token'ом.

#### GetHistoryRequest

| Field          | Type    | Description                                                                                  |
|:---------------|:--------|:---------------------------------------------------------------------------------------------|
| figi           | String  | [deprecated]Figi-идентификатор инструмента по которому запрашивается история рыночных данных |
| instrument_id  | String  | Идентификатор инструмента, принимает значения Figi или instrument_uid                        |
| year           | Integer | Год запроса истории                                                                          |


#### GetHistoryResponse

| Field | Type   | Description                                    |
|:------|:-------|:-----------------------------------------------|
| data  | Byte   | Zip-архив исторических минутных свечей за год  |

#### Пример запроса

    curl -X GET --location "https://invest-public-api.tinkoff.ru/history-data?figi=BBG00QKJSX05&year=2022" \
    -H "Authorization: Bearer token"

### Скрипт получения исторических рыночных данных по инструментам в виде годового архива

Для загрузки истории котировок за весь доступный период можно воспользоваться специальным подготовленным [скриптом](https://github.com/RussianInvestments/investAPI/blob/main/src/marketdata/download_md.sh), а так же [справочником figi](https://github.com/RussianInvestments/investAPI/blob/main/src/marketdata/figi.txt).
Вы можете создать свой справочник необходимых Вам figi по аналогии с представленным, назвать его figi.txt и сохранить в той же директории, где сохраните скрипт.

Перед запуском скрипта `download_md.sh` необходимо добавить [токен доступа](https://russianinvestments.github.io/investAPI/token) в специальный параметр.

#### Параметры настройки скрипта download_md.sh

|Field| Description                                                                                               |
| :------------- |:----------------------------------------------------------------------------------------------------------|
|figi  | Имя файла *.txt в котором хранятся figi по которым необходимо получить годовые архивы исторических данных |
|token  | [Токен доступа](https://russianinvestments.github.io/investAPI/token)                                                |


#### Результат работы скрипта

В результате успешного выполнения скрипта в директории, откуда запущен скрипт, будут сохранены zip-архивы, разбитые по инструментам и годам исторических рыночных данных.
Порядок следования полей в выходном файле:

* Идентификатор инструмента (UID)
* Дата и время начала свечи (UTC)
* Цена открытия (open)
* Цена закрытия (close)
* Максимальная цена за интервал (high)
* Минимальная цена за интервал (low)
* Объем в лотах (volume)


**Важно!!!** Просим обратить внимание на то, что данные в архиве обновляются раз в сутки, как правило ночью, соответственно текущего дня в архиве не будет.