#Лимитная политика TINKOFF INVEST API

В процессе работы торговые роботы могут генерировать огромное количество заявок. Причём особенностью именно 
алгоритмической торговли можно назвать большой процент отмен заявок. Таким образом пользователи 
могут генерировать большую нагрузку на инфраструктуру брокера. По этой причине TINKOFF INVEST API 
обладает системой динамического формирования лимитов для пользователей.

**Для всех запросов с одного адреса установлено суммарное ограничение.** Рекомендуем разрабатывать роботов таким образом,
чтобы общее число запросов по всем счетам и токенам **в секунду** не превышало 50(RPS).

**Важно** Значение лимита конкретного сервиса включает в себя суммарное количество допустимых запросов по всем методам этого сервиса.

**Важно** Лимитная политика распространяется на все аккаунты (cчета) пользователя.

###Таблица лимитов Unary-методов

| Сервисы                                                                    | Способ интеграции | Лимит unary-запросов в минуту |
|:---------------------------------------------------------------------------|:------------------|:------------------------------|
| [Сервис инструментов](/investAPI/head-instruments/)                        | gRPC<br/>REST     | 200                           |
| [Сервис счетов](/investAPI/head-users/)                                    | gRPC<br/>REST     | 100                           |
| [Сервис операций](/investAPI/head-operations/)                             | gRPC<br/>REST     | 200                           |
| Формирование отчётов в</br>[Сервисе операций](/investAPI/head-operations/) | gRPC              | 5                             |
| [Сервис котировок](/investAPI/head-marketdata/)                            | gRPC<br/>REST     | 300                           |
| <dl><dd> Метод [getHistory](/investAPI/get_history)</dd></dl>              | REST              | 30                            |
| [Сервис стоп-ордеров](/investAPI/head-stoporders/)                         | gRPC<br/>REST     | 50                            |
| [Песочницы](/investAPI/head-sandbox/)                                      | gRPC<br/>REST     | 200                           |
| [Сервис ордеров](/investAPI/head-orders/)                                  | gRPC<br/>REST     | 100                           |
 | <dl><dd> Метод [getOrders](/investAPI/orders#getorders)</dd></dl>         | gRPC<br/>REST     | 200                           |
 | <dl><dd>Метод [postOrder](/investAPI/orders#postorder)     </dd></dl>     | gRPC<br/>REST     | 300                           |
| <dl><dd>  Метод [cancelOrder](/investAPI/orders#cancelorder)    </dd></dl> | gRPC<br/>REST     | 100                           |



Всего существует 5 уровней доступа, которые зависят от количества выставленных заявок (любого типа) и
процента их исполнения:

| Лимитный грейд   | Активных stream-соединений</br>[Сервиса котировок](/investAPI/head-marketdata/) | Активных stream-соединений</br>[Сервиса ордеров](/investAPI/head-orders/) | Активных stream-соединений</br>[Сервиса операций](/investAPI/head-operations/) |
| :-------------   |:--------------------------------------------------------------------------------|:--------------------------------------------------------------------------|:-------------------------------------------------------------------------------|
| 1                | 2                                                                               | 1                                                                         | 1                                                                              |
| 2                | 4                                                                               | 1                                                                         | 1                                                                              |
| 3                | 5                                                                               | 1                                                                         | 1                                                                              |
| 4                | 16                                                                              | 1                                                                         | 1                                                                              |
| 5                | 64                                                                              | 1                                                                         | 1                                                                              |

**Важно** В рамках одного stream-соединения [сервиса котировок](/investAPI/head-marketdata/) существует 
ограничение в **300** одновременных подписок на свечи, стаканы и ленту обезличенных сделок. Лимит считается
суммарно по всем трём типам данных. Лимитов на количество подписок в рамках одного стрима на торговые
статусы инструментов (подписка Info) **нет**.

**Важно** В методе [Запрос тарифа пользователя](https://russianinvestments.github.io/investAPI/users/#getusertariff) лимиты для стрим
соединений могут возвращаться на 1 больше, это сделано на балансировщике для того, чтобы вы могли переподключить стримы,
поэтому мы не рекомендуем использовать максимальное количество из лимита. 

**Важно** При превышении лимита клиент получит соответствующую ошибку. Превышение лимита не произойдет, если количество запросов в минуту с IP-адреса клиента не превышает 1000 запросов. Если вы подозреваете, что ваш IP-адрес забанили - обратитесь к нам в поддержку или в [Telegram-чат по общим вопросам](https://t.me/joinchat/VaW05CDzcSdsPULM).

Счетчик количества стрим соединений обновляется каждые 2 минуты.

Изменения лимитного грейда пользователя происходит раз в сутки после окончания торгов. Для изменения
грейда берётся статистика заявок, выполненных пользователем за последние 30 дней от текущей даты. 
Т.е. чем больше пользователь выставляет заявок при сохранении высокого уровня исполнения, 
тем выше его лимиты.

Стоит дополнительно отметить, что лимита на количество активных заявок нет.

Расчёт лимитных грейдов происходит только для пользователей TINKOFF INVEST API,
выставлявших заявки. Поэтому, если вы не используете данную
версию апи для выставления заявок, у вас будет грейд 1. 
Для того чтобы расчёт грейда происходил, нужно выставить хотя бы одну заявку
в месяц.

| Количество исполненных заявок / </br> процент исполнения | больше 50% | больше 10% | больше 2% | меньше 2% |
|:----------------------------------------------------------| :--------- | :--------- | :--------- | :--------- |
| меньше **10**                                             | 1          | 1          | 1          | 1          | 
| меньше **200**                                            | 2          | 2          | 2          | 1          | 
| меньше **1 000**                                          | 4          | 3          | 2          | 1          | 
| меньше **5 000**                                          | 5          | 4          | 3          | 1          | 
| меньше **10 000**                                         | 5          | 5          | 4          | 2          | 
| больше **10 000**                                         | 5          | 5          | 4          | 2          | 
