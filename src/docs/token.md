#Токен для работы с TINKOFF INVEST API

Токен – это набор символов, в котором зашифрована информация о владельце, правах доступа 
и прочей необходимой для авторизации в TINKOFF INVEST API
информации. В процессе работы с TINKOFF INVEST API токен следует передавать в metadata
каждого unary-запроса, а также в запросах на установление всех видов stream-соединений.
Работа с TINKOFF INVEST API без выпуска и использования токена невозможна.

##Виды токенов

В TINKOFF INVEST API существует несколько видов токенов с разным набором доступных прав — вы
можете выпустить несколько токенов для решения разных задач алгоритмической торговли или
мониторинга рынка ценных бумаг.

* **Readonly token** — данный тип токена предназначен только для получения различной
  информации, такой как состояние портфеля, расписание торгов различных торговых площадок, текущие
  котировки, исторические данные и т.п. С данным типом токена невозможно выставление
  торговых поручений.

* **Full-access token** — с данным типом токена доступно выполнение всех методов
  TINKOFF INVEST API. Это основной тип токена для реальной работы с TINKOFF INVEST API.

* **Токен с доступом к конкретному счёту** — данный вид токена позволяет получить доступ только к
  одному конкретному счёту пользователя. Уровень прав доступа (readonly, full-access) при этом так же
  можно настроить.

* **Sandbox token** – токен для работы с песочницей. Песочница – это эмуляция работы
  торговых площадок, основанная на реальных данных, но не ведущая к изменению состава
  портфеля или баланса вашего счёта. Данный тип токена предназначен в первую очередь для
  тестирования вашего робота и проверки работоспособности всех алгоритмов.

##Получение токена

1. Перейдите в настройки профиля Тинькофф Инвестиции по ссылке: [https://www.tinkoff.ru/invest/settings/](https://www.tinkoff.ru/invest/settings/)
2. Авторизуйтесь в системе, если это требуется.
3. Функция "Подтверждение сделок кодом" должна быть отключена. **Обратите внимание, что сделки на сумму
выше 6 000 000 рублей или $100 000, или €100 000 требуют подтверждения, т.е. будут недоступны через API.**
4. Выпустите токен TINKOFF INVEST API для биржи и/или Sandbox. Возможно, система попросит вас авторизоваться
   еще раз. Не беспокойтесь, это необходимо для подключения робота к торговой платформе.
5. Скопируйте токен и сохраните его. Токен отображается только один раз, просмотреть его позже не
   получится. Тем не менее вы можете выпускать неограниченное количество токенов.

##Срок жизни токена

Срок жизни токена составляет три месяца с даты последнего использования. 

Убедитесь, что ваши обращения выполняются с актуальным токеном. Если была получена ошибка 40003, то это значит, что токен перестал быть актуальным.
Токен может перестать быть актуальным в следующих случаях:

- Пользователь перестал быть клиентом Тинькофф;
- Пользователь завершил активные сессии для всех устройств;
- Блокировка аккаунта пользователя;
- Блокировка карты пользователя;
- Осуществлен отзыв токенов.

##Отзыв токена

Отозвать токен TINKOFF INVEST API можно на странице [https://id.tinkoff.ru/account](https://id.tinkoff.ru/account).

##Невалидный токен

В случае использования невалидного токена Вы получите ошибку:
```
"code": "40003"
"message": "authentication token is missing or invalid"
```

##Использование токена песочницы

Токен песочницы можно использовать только для [сервиса песочницы](https://russianinvestments.github.io/investAPI/head-sandbox/).

В случае использования sandbox-токена для обычных методов и стримов, будет возвращена ошибка.