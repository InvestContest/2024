####[Для чего используется параметр order_id метода PostOrder?](#4.1)  
####[Можно ли увидеть ключ идемпотентности order_id в операциях, выставленных поручениях и т.п.? ](#4.2)  
####[Как долго хранится ключ идемпотентности (order_id) на стороне брокера?](#4.3)  
####[Что передавать в параметр quantity метода PostOrder? Количество бумаг или количество лотов?](#4.4)  
####[Как рассчитать полную стоимость сделки?](#4.5)  
####[Можно ли получить список уже исполненных торговых поручений?](#4.6)  
####[Какие статусы торговых поручений бывают и что они значат?](#4.7)  
####[Почему лимитная заявка исполнилась по другой цене?](#4.8)  
####[Как перевести цену поручения в тип Quotation?](#4.9)  
####[Как изменить выставленную заявку?](#4.10)  
####[Можно ли выставлять поручения по счету инвест копилки?](#4.11)  
####[Необходимо ли включение маржинальной торговли для торгов на срочном рынке?](#4.12)  
####[Чем отличается рыночная заявка от лимитной?](#4.13)  
####[Чем отличается метод GetOrders и методом GetOrderState?](#4.14)  
####[Существуют ли ограничения на стоимость заявки?](#4.15)  

###Для чего используется параметр order_id метода [PostOrder](/investAPI/orders#postorder)? <a id="4.1"></a>

 На данный момент мы имеем два параметра с одинаковым наименованием:

* *order_id* как входной параметр - ключ идемпотентности в формате UID. Срок хранения ключа идемпотентности один год.
* *order_id* как выходной параметр - биржевой идентификатор заявки, используемый в дальнейшем для отслеживания статуса ордера. 

В первом случае order_id используется в качестве ключа идемпотентности в формате UID. Это значит, что многократный вызов метода
[PostOrder](/investAPI/orders#postorder) с одинаковым order_id не приведёт к выставлению более одного
торгового поручения. 
При вызове метода происходит проверка уникальности связки order_id и account_id, если указанная пара не найдена,
то создаётся новое торговое поручение, а если указанная связка уже существует (поручение с данным order_id по
данному номеру счёта было выставлено раньше), то метод [PostOrder](/investAPI/orders#postorder) вернёт статус
уже выставленного торгового поручения, т.е. отработает согласно логике метода [GetOrderState](/investAPI/orders#getorderstate).



###Можно ли увидеть ключ идемпотентности ([order_id](/investAPI/orders#postorderrequest)) в операциях, выставленных поручениях и т.п.? <a id="4.2"></a>

В данный момент order_id используется исключительно как ключ идемпотентности и не "прокидывается" в другие сущности системы.
Есть планы в будущем отображать переданный ключ в операциях.

###Как долго хранится ключ идемпотентности (order_id) на стороне брокера? <a id="4.3"></a>

Ключ хранится год, но пока никаких гарантий его сохранности дать не можем (механизм вероятно будет 
пересматриваться). Пока подразумевается полная уникальность переданного order_id в разрезе номера счёта (account_id).

###Что передавать в параметр quantity метода [PostOrder](/investAPI/orders#postorder)? Количество бумаг или количество лотов? <a id="4.4"></a>

Метод [PostOrder](/investAPI/orders#postorder) принимает в качестве параметра quantity требуемое количество **лотов**.
Многие инструменты имеют [лотность](/investAPI/glossary#lot) отличную от единицы, это следует обязательно учитывать
при выставлении торговых поручений. 

###Как рассчитать полную стоимость сделки? <a id="4.5"></a>

Полная стоимость сделки включает в себя не только сумму операции покупки или продажи биржевого инструмента,
но и [комиссии брокера](https://www.tinkoff.ru/invest/help/brokerage/account/get-bs/tariff/#:~:text=%D0%9E%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8C%20%D0%B1%D1%80%D0%BE%D0%BA%D0%B5%D1%80%D1%81%D0%BA%D0%B8%D0%B9%20%D1%81%D1%87%D0%B5%D1%82-,%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5%20%D0%BA%D0%BE%D0%BC%D0%B8%D1%81%D1%81%D0%B8%D0%B8%20%D0%B5%D1%81%D1%82%D1%8C%20%D0%B2%20%D1%82%D0%B8%D0%BD%D1%8C%D0%BA%D0%BE%D1%84%D1%84%20%D0%B8%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D1%8F%D1%85%3F,-%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%BE%D1%80), сервисные комиссии, гарантийное обеспечение для операций с фьючерсами и т.п. 
Рассчитать размеры комиссий можно из описания [вашего тарифа]((https://www.tinkoff.ru/invest/help/brokerage/account/get-bs/tariff/#:~:text=%D0%9E%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8C%20%D0%B1%D1%80%D0%BE%D0%BA%D0%B5%D1%80%D1%81%D0%BA%D0%B8%D0%B9%20%D1%81%D1%87%D0%B5%D1%82-,%D0%BA%D0%B0%D0%BA%D0%B8%D0%B5%20%D0%BA%D0%BE%D0%BC%D0%B8%D1%81%D1%81%D0%B8%D0%B8%20%D0%B5%D1%81%D1%82%D1%8C%20%D0%B2%20%D1%82%D0%B8%D0%BD%D1%8C%D0%BA%D0%BE%D1%84%D1%84%20%D0%B8%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%B8%D1%86%D0%B8%D1%8F%D1%85%3F,-%D0%98%D0%BD%D0%B2%D0%B5%D1%81%D1%82%D0%BE%D1%80)), но нужно учитывать, что комиссии берутся за
сделки, а не за поручение, т.е. одно торговое поручение может рождать несколько сделок. Процент комиссии фиксированный в зависимости от тарифа. Размер начальной
комиссии и фактической можно узнать в деталях торгового поручения (методом [GetOrderState](/investAPI/orders#getorderstate)).

Подробнее про расчёт стоимости сделок с фьючерсами и облигациями: 
[Цены облигаций и фьючерсов](/investAPI/faq_marketdata/).

###Можно ли получить список уже исполненных торговых поручений? <a id="4.6"></a>

В данный момент метод [GetOrders](/investAPI/orders#getorders) возвращает только список активных торговых
поручений, т.е. поручений, которые ещё не исполнены и не отменены. Получить полный список уже исполненных
торговых поручений в данный момент невозможно. 

###Какие статусы торговых поручений бывают и что они значат?<a id="4.7"></a> 

Описание статусной модели торговых поручений: [Статусная модель торговых поручений](/investAPI/head-orders#_2).

Некоторые нюансы исполнения поручений: [Алгоритм и особенности исполнения торговых поручений](/investAPI/orders_details/).

###Почему лимитная заявка исполнилась по другой цене?<a id="4.8"></a> 

Лимитное торговое поручение исполняется либо по указанной при её выставлении цене, либо по цене "лучшей"
для определённого направления сделки. Этот механизм на бирже называется Best Execution и подразумевает
исполнение торгового поручения по цене выгоднее, указанной в поручении. 

###Как перевести цену поручения в тип Quotation? <a id="4.9"></a>

Подробнее о работе с нестандартными типами данных: [Нестандартные типы данных TINKOFF INVEST API](/investAPI/faq_custom_types/)


###Как изменить выставленную заявку?<a id="4.10"></a>

Для изменения выставленного торгового поручения в TINKOFF INVEST API добавлен метод [replaceOrder](/investAPI/orders#replaceorder).

Данный метод позволяет изменить существующую выставленную заявку, путем ее отмены и выставления новой заявки с измененными параметрами.

###Можно ли выставлять поручения по счету инвест копилки? <a id="4.11"></a>   

Нет, при попытке выставления поручений по счету инвест копилки в методе [PostOrder](/investAPI/orders#postorder) в ответ
будет возвращена ошибка с "code":"40004" и "message": "Working with orders is not available with this account". 

###Необходимо ли включение маржинальной торговли для торгов на срочном рынке? <a id="4.12"></a>

Да, для выставления поручений на срочном рынке, необходимо включить маржинальную торговлю в приложении и терминале.
Иначе будет возвращена ошибка 30051 из [Списка кодов ошибок](https://russianinvestments.github.io/investAPI/errors/)

###Чем отличается рыночная заявка от лимитной?<a id="4.13"></a>
| Рыночная заявка| Лимитная заявка| 
|----------|----------|
| Это заявка на покупку или продажу активов по той цене, что есть на бирже в данный момент.   | Это указание брокеру, какую бумагу или валюту, сколько лотов и по какой цене вы хотите купить или продать  | 
| Если в данный момент на бирже по текущей цене торгуется меньше лотов, чем вы указали и при этом другие лоты есть, но их цена отличается в негативную для вас сторону, то в этом случае брокер купит имеющееся количество лотов по текущей цене, а оставшуюся часть заявки будет покупать по следующей по списку цене. |Для сделок **покупки** лимитную заявку исполнят по цене равной или дешевле той, что вы указали. Для сделок **продажи** лимитную заявку исполнят по цене равной или выше той, что вы указали.  | 
| Стоит использовать, только когда вам срочно нужно купить или продать актив по любой цене — и вы готовы к тому, что она может оказаться для вас невыгодной.   | Стоит использовать, чтобы не тратить время на постоянное отслеживание котировок на бирже и выполнить заявку по выгодной цене.  | 

Помимо рыночных и лимитных заявок, Tinkoff Invest API позволяет выставлять заявки типа "Лучшая цена". [Что такое заявка «Лучшая цена»?](https://www.tinkoff.ru/invest/help/brokerage/account/trade-on-bs/bids/?card=q6#:~:text=%D0%BD%D0%B5%D0%B2%D1%8B%D0%B3%D0%BE%D0%B4%D0%BD%D0%BE%D0%B9%20%D1%86%D0%B5%D0%BD%D0%B5%20%D0%BF%D0%BE%D0%BA%D1%83%D0%BF%D0%BA%D0%B8.-,%D1%87%D1%82%D0%BE%20%D1%82%D0%B0%D0%BA%D0%BE%D0%B5%20%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B0%20%C2%AB%D0%BB%D1%83%D1%87%D1%88%D0%B0%D1%8F%20%D1%86%D0%B5%D0%BD%D0%B0%C2%BB%3F,-%D0%AD%D1%82%D0%BE%20%D0%B7%D0%B0%D1%8F%D0%B2%D0%BA%D0%B0%20%D0%BD%D0%B0)

###Чем отличается метод [GetOrders](/investAPI/orders#getorders) и методом [GetOrderState](/investAPI/orders#getorderstate)? <a id="4.14"></a>

| [GetOrders](/investAPI/orders#getorders)| [GetOrderState](/investAPI/orders#getorderstate)| 
|----------|----------|
| Предполагает получение массива активных заявок. | Предполагает получение статуса конкретной заявок по *order_id*. | 
| Возвращает только список активных торговых поручений, т.е. поручений, которые ещё не исполнены и не отменены. | Возвращает торговое поручение конкретного инструмента в любом статусе (в том числе после исполнения). | 
| Максимальный срок получения частично исполненной заявки через метод - до конца торгового дня, когда все неисполненные заявки отменяются и требуют повторного выставления.  |Метод не предусмотрен для получения глубокой истории и может не возвращать информацию по поручениям "старше" одних суток.  | 

###Существуют ли ограничения на стоимость заявки? <a id="4.15"></a>

Да, на данный момент такие ограничения существуют. Поскольку на данный момент нет возможности выставить заявку стоимостью выше установленных значений для каждой из валют в Tinkoff Invest API (потребуется подтверждение заявки по sms), необходимо разбивать такие заявки на заявки меньшего размера.

В случае, если вы превысите лимит, вы получите ошибку 90003. [Все коды ошибок](/investAPI/errors).

**Лимиты для на стоимость заявки для разных валют**

| Валюта | Полное название валюты | Лимит |
|----------|----------|----------|
| RUB | Рубль  | 30 000 000   |
| USD   | Доллар США | 500 000  |
| EUR    | Евро  | 500 000  |
| GBP   | Фунт стерлингов  | 5 000 |
| CHF  | Швейцарский франк  | 5 000 |
| CNY   | Юань | 50 000 |
| JPY | Иена  | 500 000 |
| HKD  | Гонконгский доллар  | 50 000 |
| TRY   | Турецкая лира   | 50 000 |
| KZT  | Казахстанский тенге  | 500 000 |
| BYN  | Белорусский рубль | 50 000 |
| AMD   | Армянский драм  | 500 000 |
| UZS  | Узбекский сум  | 5 000 000 |
| KGS   | Киргизский сом  | 50 000 |
| TJS  | Таджикский сомони   | 50 000|
| XAU   | Золото  | 50 000 |
| XAG  | Серебро  | 50 000 |

