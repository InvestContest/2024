#Песочница TINKOFF INVEST API

##Адреса сервиса TINKOFF INVEST API Sandbox

Для работы с песочницей существуют два способа:

1. Все вызовы сервиса песочницы выполняются по адресу **`sandbox-invest-public-api.tinkoff.ru:443`**.
2. Пользоваться методами Sandbox-сервиса.

**Команда TINKOFF INVEST API рекомендует пользоваться первым способом**.

Различия работы контуров описаны на [странице](/investAPI/url_difference/).

##Методы по работе со счетами песочницы. 

Для тестирования своего торгового робота в песочнице можно использовать неограниченное
количество счетов, которые существуют только в песочнице и не имеют отношения к реальным
торгам на бирже. 

* [OpenSandboxAccount](/investAPI/sandbox#opensandboxaccount) — метод создания специального счёта песочницы;
* [SandboxPayIn](/investAPI/sandbox#sandboxpayin) — пополнение баланса счёта песочницы;
* [CloseSandboxAccount](/investAPI/sandbox#closesandboxaccount) — метод закрытия счёта в песочнице.


Обратите внимание, что пополнение счёта песочницы возможно только в рублях. Для выполнения операций с другой валютой расчётов, следует эту валюту сперва купить c помощью метода [PostOrder](/investAPI/orders#postorder).

Для получения списка своих счетов в песочнице используется метод [getAccount](/investAPI/sandbox#getaccounts).

**Важно!** Все счета в песочнице являются виртуальными и могут быть удалены в любой
момент времени. Если созданный ранее счёт не найден, создайте, пожалуйста, новый. 
Счета хранятся 3 месяца с даты последнего использования.

**Важно!** В песочнице отсутствуют стоп-заявки, маржинальные показатели, а также не производится расчёт дополнительных показателей счёта,
ставок риска и размер гарантийного обеспечения, ликвидности портфеля.

##Методы получения состояния портфеля в песочнице

Методы получения операций и портфеля аналогичны таким же методам основных сервисов:

* [getSandboxOperations](/investAPI/sandbox#getsandboxoperations) — получение операций по счёту;
* [getSandboxPortfolio](/investAPI/sandbox#getsandboxportfolio) — получение портфолио по счёту;
* [getSandboxPositions](/investAPI/sandbox#getsandboxpositions) — получение списка позиций по счёту. 

Обратите, что для методов песочницы не рассчитываются некоторые статистические параметры
портфеля, такие как относительная и абсолютные доходности и т.п.

##Методы по работе с торговыми поручениями в песочнице

Параметры методов выставления, отмены, получения статуса торгового поручения в 
песочнице аналогичны методам основной работы с TINKOFF INVEST API. 

* [postSandboxOrder](/investAPI/sandbox#postsandboxorder) — выставление торгового поручения;
* [getSandboxOrderState](/investAPI/sandbox#getsandboxorderstate) — получение статуса торгового поручения;
* [cancelSandboxOrder](/investAPI/sandbox#cancelsandboxorder) — отмена выставленного торгового поручения;
* [getSandboxOrders](/investAPI/sandbox#getsandboxorders) — получение списка торговых поручений по счёту;


##Методы сервиса операций в песочнице
* [GetDividendsForeignIssuer](/investAPI/sandbox#getdividendsforeignissuer) - получение отчёта "Справка о доходах за пределами РФ";  
Обращаем ваше внимание, что в данном методе песочницы будет возвращать:
```
"div_foreign_issuer_report": {     
        "dividends_foreign_issuer_report": [],
        "itemsCount": 0,     
        "pagesCount": 0,     
        "page": 0   
},
"payload": "div_foreign_issuer_report"
```
* [GetBrokerReport](/investAPI/sandbox#getbrokerreport) - получение брокерского отчёта;  
Обращаем ваше внимание, что в данном методе песочницы будет возвращать:
```
"get_broker_report_response": {
    "broker_report": [],
    "itemsCount": 0,     
    "pagesCount": 0,     
    "page": 0
},
"payload": "get_broker_report_response"
```
* [PortfolioStream](/investAPI/sandbox#portfoliostream) - server-side stream обновлений портфеля;
* [PositionsStream](/investAPI/sandbox#positionsstream) - server-side stream обновлений информации по изменению позиций портфеля;
* [GetPortfolio](/investAPI/sandbox#getportfolio) - получение портфеля по счёту.

##Методы сервиса ордеров в песочнице
* [TradesStream](/investAPI/sandbox#tradesstream) - получение портфеля по счёту.

##Методы сервиса cчетов в песочнице
* [GetMarginAttributes](/investAPI/sandbox#getmarginattributes) - получение портфеля по счёту. Обращаем ваше внимание, что в данном методе песочницы будут возвращены: 
  * значение параметра liquid_portfolio (ликвидной стоимости портфеля) = стоимости портфеля. 
  * starting_margin  = corrected_margin = minimal_margin = amount_of_missing_funds = 0
  * funds_sufficiency_level = 2

<a name="orderexecute"></a>
###Алгоритм исполнения торговых поручений в песочнице

Алгоритм исполнения торговых поручений в песочнице отличается от "боевого" алгоритма. 
Также следует обязательно учитывать, что в песочнице полностью отсутствует влияние
совершаемых сделок на рынок. Рыночные заявки в песочнице исполняются по last_price полученному с биржи.

1. При выставлении торгового поручения со счёта песочницы сразу же списываются активы или начисляются
валютные средства. **Операции при этом появятся только при исполнении торгового поручения**.
2. Сервис получает от торговых площадок информацию о последних сделках по всем 
инструментам. 
3. Если для инструмента есть активные торговые поручения в песочнице, то сервис 
определяет сделки, цена для которых пройдена. </br>Например, существует заявка на покупку 
акции по цене 100 руб.; если цена инструмента в последней сделке с биржи равна 100 или менее
рублей, то заявка исполняется **по цене, которая была в ней указана** (т.е. по 100 руб).
</br>Если же заявка на продажу, то она исполнится, когда цена последней сделки будет 100 или более
рублей.
4. Все неисполненные торговые поручения в песочнице удаляются после окончания торговой сессии. 
Списанные активы возвращаются на счёт.
